[//]: # ( )
[//]: # (This file is automatically generated by the `jsarch`)
[//]: # (module. Do not change it elsewhere, changes would)
[//]: # (be overriden.)
[//]: # ( )
# Architecture Notes



## PostgreSQL service

This service is a simple wrapper around the `pg` node module.

API Doc: https://node-postgres.com/features/pooling

[See in context](./src/pg.ts#L59-L64)



### Prepared queries

The `pg` module uses simple `$n` placeholder for queries values
 that are provided in an array.

 This function adds a level of abstraction that refers to fields
 in an object instead, transforming a query executions like
 `SELECT * FROM users WHERE id=$$userId` with { userId: 1 }
 into `SELECT * FROM users WHERE id=$1` with [1] under the
 hood.

It also adds check to ensure the provided arguments exists.

[See in context](./src/pg.ts#L213-L225)



### Errors casting

This service also convert `pg` errors into `yerror` ones which taste
 better imo.

[See in context](./src/pg.ts#L248-L252)



#### Mocking pg

The pg mock uses the [`jest`](https://jestjs.io) under the hood.
 You will have to use Jest to use it.

Its purpose it to ensure queries are well formed while mocking
 in the tests and that the values placeholder really have a value
 associated to it in the values hash.

[See in context](./src/pg.mock.ts#L7-L15)



### Timezones

Ensure not messing with time zones with practical defaults.
See https://github.com/vitaly-t/pg-promise/issues/389

// TODO: Ensure arrays are well parsed too with `postgres-array` for
// 1115 - timestamp without time zone[]
// 1182 - date[]

[See in context](./src/pg.ts#L10-L18)

